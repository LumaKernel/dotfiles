# ddc.vim
[[plugins]]
repo = 'Shougo/ddc.vim'
if = 'g:complete_mode is# "ddc"'
hook_add = '''
set completeopt=menuone
'''
hook_post_source = '''
if g:complete_mode is# "ddc"
  if has('nvim')
    call ddc#custom#patch_global('sources', [
        \ 'treesitter',
        \ 'tabnine',
        \ 'file',
        \ 'around',
        \ 'buffer',
        \ 'deoppet',
        \ 'nextword',
      \ ])
  else
    call ddc#custom#patch_global('sources', [
        \ 'tabnine',
        \ 'file',
        \ 'around',
        \ 'buffer',
        \ 'deoppet',
        \ 'nextword',
      \ ])
  endif

  call ddc#custom#patch_global('sourceOptions', {
      \ '_': {
      \   'matchers': ['matcher_fuzzy'],
      \   'sorters': ['sorter_rank'],
      \   'ignoreCase': v:true,
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'around': {
      \   'mark': 'A',
      \   'minAutoCompleteLength': 4,
      \ }})
  call ddc#custom#patch_global('sourceParams', {
      \ 'around': {
      \   'maxSize': 500,
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'buffer': {
      \   'mark': 'B',
      \   'minAutoCompleteLength': 4,
      \ }})
  call ddc#custom#patch_global('sourceParams', {
      \ 'buffer': {
      \   'requireSameFiletype': v:false,
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'nextword': {
      \   'mark': 'next',
      \   'maxCandidates': 4,
      \   'isVolatile': v:true,
      \   'minAutoCompleteLength': 3,
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'deoppet': {
      \   'dup': v:true,
      \   'mark': 'dp',
      \   'minAutoCompleteLength': 2,
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'tabnine': {
      \   'mark': 'TN',
      \   'maxCandidates': 5,
      \   'isVolatile': v:true,
      \   'minAutoCompleteLength': 2,
      \   'forceCompletionPattern': '..',
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'file': {
      \   'mark': 'F',
      \   'isVolatile': v:true,
      \   'forceCompletionPattern': '\S/\S*',
      \ }})
  call ddc#custom#patch_filetype(
      \ ['ps1', 'dosbatch', 'autohotkey', 'registry'], {
      \ 'sourceOptions': {
      \   'file': {
      \     'forceCompletionPattern': '\S\\\S*',
      \   },
      \ },
      \ 'sourceParams': {
      \   'file': {
      \     'mode': 'win32',
      \   },
      \ }})

  call ddc#custom#patch_global('sourceOptions', {
      \ 'treesitter': {
      \   'mark': 'TS',
      \ }})

  inoremap <silent><expr> <TAB>
      \ pumvisible() ? '<C-n>' :
      \ (col('.') <= 1 <Bar><Bar> getline('.')[col('.') - 2] =~# '\s') ?
      \ '<TAB>' : ddc#manual_complete()
  inoremap <silent><expr> <C-n> ddc#manual_complete()

  inoremap <expr><S-TAB> pumvisible() ? '<C-p>' : '<C-h>'

  " XXX: experimental
  " if exists('g:ddc#_initialized')
  "   call ddc#enable()
  " else
  "   augroup my-ddc
  "     autocmd User DDCReady ++once call ddc#enable()
  "   augroup END
  " endif
  call timer_start(1000, {->execute('call ddc#enable()')})

  " Debug
  " call ddc#custom#patch_global('sources', ['around'])
  " call ddc#custom#patch_global('sources', ['file'])
endif
'''

[[plugins]]
repo = 'Shougo/ddc-around'
depends = ['ddc.vim']

[[plugins]]
repo = 'Shougo/ddc-sorter_rank'
depends = ['ddc.vim']

[[plugins]]
repo = 'Shougo/ddc-matcher_head'
depends = ['ddc.vim']

[[plugins]]
repo = 'matsui54/ddc-matcher_fuzzy'
depends = ['ddc.vim']

[[plugins]]
repo = 'Shougo/ddc-nextword'
depends = ['ddc.vim']

[[plugins]]
repo = 'delphinus/ddc-treesitter'
if = 'has("nvim")'
depends = ['ddc.vim', 'nvim-treesitter']

[[plugins]]
repo = 'LumaKernel/ddc-file'
depends = ['ddc.vim']

[[plugins]]
repo = 'matsui54/ddc-buffer'
depends = ['ddc.vim']

[[plugins]]
repo = 'LumaKernel/ddc-tabnine'
if = '!IsPrivateMode()'
depends = ['ddc.vim']
hook_add = '''
command! -bar EditTabNineConfig execute 'edit' ddc_tabnine#config_dir() . '/tabnine_config.json'
'''


# Debug

# [[plugins]]
# repo = '~/ghq/github.com/LumaKernel/ddc-file'
# if = 1
# depends = ['ddc.vim']
# merged = 0
# hook_add = '''
# '''
