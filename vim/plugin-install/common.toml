[[plugins]]
repo = 'Shougo/dein.vim'


# Fern
[[plugins]]
repo = 'lambdalisue/fern.vim'
hook_add = '''
let g:fern#profile = 0
let g:fern#disable_viewer_auto_duplication = 1
let s:fern_default_exclude_pats = [
  \   '^\.git$',
  \   '^\.DS_Store$',
  \   '^node_modules$',
  \   '^dist$',
  \   '^:Zone\.Identifier$',
  \   '^__pycache__$',
  \   '^yarn.lock$',
  \   '^package-lock.json$',
  \ ]

function! s:GetFernExclude() abort
  let ignore_pats = copy(s:fern_default_exclude_pats)
  return join(ignore_pats, '\|')
endfunction


let g:fern#default_hidden = 1
let g:fern#default_exclude = s:GetFernExclude()

function! s:init_fern() abort
  silent! nunmap <buffer> t
endfunction

function! FernRevealPwdOrThere() abort
  if !filereadable(expand('%'))
    Fern .
    return ''
  endif
  let F = vital#vital#import('System.Filepath')
  " TODO: VCS まで登ってもいいかも
  let dir = expand('%:p:h')
  if F.contains(dir, getcwd())
    let dir = getcwd()
  endif
  exe printf('Fern %s -reveal=%%', dir)
  return ''
endfunction

function! s:fern_default() abort
  let exclude_save = g:fern#default_exclude
  let g:fern#default_exclude = s:GetFernExclude()
  call FernRevealPwdOrThere()
  let g:fern#default_exclude = exclude_save
endfunction

function! s:fern_all() abort
  let exclude_save = g:fern#default_exclude
  let g:fern#default_exclude = ''
  call FernRevealPwdOrThere()
  let g:fern#default_exclude = exclude_save
endfunction

nnoremap <silent> <Leader>ai :<C-u>call <SID>fern_default()<CR>
nnoremap <silent> <Leader>aa :<C-u>call <SID>fern_all()<CR>
nnoremap <silent> <Leader>ak :<C-u>Fern bookmark:///<CR>

augroup my-fern
  autocmd! *
  " autocmd FileType fern call s:init_fern()
augroup END

let g:loaded_netrw             = 1
let g:loaded_netrwPlugin       = 1
let g:loaded_netrwSettings     = 1
let g:loaded_netrwFileHandlers = 1

augroup my-fern-hijack
  autocmd!
  autocmd BufEnter * ++nested call s:hijack_directory()
augroup END

function! s:hijack_directory() abort
  let path = expand('%')
  if !isdirectory(path)
    return
  endif
  exe 'Fern' path
endfunction
'''

# Asterisk Improved
[[plugins]]
repo = 'haya14busa/vim-asterisk'
hook_add = '''
let g:asterisk#keeppos = 1
map *  <Plug>(asterisk-z*)
map #  <Plug>(asterisk-z*)N
map g* <Plug>(asterisk-gz*)
map g# <Plug>(asterisk-gz*)N
xmap *  <Plug>(asterisk-z*)
xmap #  <Plug>(asterisk-z*)N
xmap g* <Plug>(asterisk-gz*)
xmap g# <Plug>(asterisk-gz*)N
'''

# Vital Vim
[[plugins]]
repo = 'vim-jp/vital.vim'
merged = 0
[[plugins]]
repo = 'haya14busa/vital-safe-string'
depends = ["vital.vim"]
[[plugins]]
repo = 'lambdalisue/vital-Whisky'
depends = ["vital.vim"]
